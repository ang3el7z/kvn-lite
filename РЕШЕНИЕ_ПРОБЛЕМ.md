# Решение проблемы: бот не отвечает после установки

## Что было исправлено

1. **Исправлен баг в обработке ошибок API Telegram** - теперь ошибки правильно логируются
2. **Добавлено подробное логирование** авторизации и работы бота
3. **Добавлена обработка ошибок** при отсутствии config.php

## Как проверить что не так с ботом

### Шаг 1: Проверьте логи на сервере

Выполните на сервере:

```bash
# Проверьте основные логи
tail -50 /logs/php_error        # Ошибки PHP
tail -50 /logs/auth_debug       # Что происходит при авторизации
tail -50 /logs/requests_error   # Ошибки при отправке сообщений в Telegram
tail -50 /logs/bot_input        # Входящие запросы от Telegram
```

### Шаг 2: Проверьте файл config.php

```bash
# Проверьте что файл существует
ls -la app/config.php

# Посмотрите содержимое
cat app/config.php
```

Файл должен содержать минимум:
```php
<?php

$c = ['key' => 'ВАШ_ТОКЕН_БОТА'];
```

Если файла нет - создайте его:
```bash
echo "<?php\n\n\$c = ['key' => 'ВАШ_ТОКЕН_БОТА'];" > app/config.php
chmod 666 app/config.php
```

### Шаг 3: Проверьте webhook

Webhook должен быть настроен на: `https://ВАШ_IP/tlgrm?k=ТОКЕН_БОТА`

Проверить можно так:
```bash
curl "https://api.telegram.org/botВАШ_ТОКЕН/getWebhookInfo"
```

Если webhook не настроен, запустите:
```bash
php app/init.php
```

### Шаг 4: Проверьте права доступа

```bash
# Убедитесь что директория логов существует и доступна для записи
mkdir -p /logs
chmod 777 /logs

# Убедитесь что config.php доступен для записи
chmod 666 app/config.php
```

## Типичные проблемы

### Проблема 1: В логах `/logs/php_error` ошибка "config.php not found"
**Решение:** Создайте файл `app/config.php` как показано выше

### Проблема 2: В логах `/logs/auth_debug` нет записей
**Решение:** 
- Проверьте что webhook работает (см. шаг 3)
- Проверьте что запросы доходят до сервера (смотрите `/logs/bot_input`)

### Проблема 3: В логах `/logs/requests_error` ошибки API
**Решение:**
- Проверьте что токен бота правильный
- Проверьте что бот не заблокирован в Telegram
- Проверьте интернет соединение сервера

### Проблема 4: Пользователь не становится админом
**Решение:**
1. Проверьте логи `/logs/auth_debug` - должно быть сообщение "Creating first admin"
2. Проверьте что `app/config.php` доступен для записи
3. После отправки сообщения проверьте содержимое `config.php`:
   ```bash
   cat app/config.php | grep admin
   ```
   Должно быть что-то вроде: `'admin' => array ( 0 => 123456789, )`

## После применения исправлений

1. **Перезапустите веб-сервер:**
   ```bash
   # Если используете systemd
   systemctl restart php-fpm
   systemctl restart nginx
   
   # Если используете Docker
   docker-compose restart
   ```

2. **Отправьте боту `/start` или `/menu`**

3. **Проверьте логи:**
   ```bash
   tail -20 /logs/auth_debug
   ```

4. **Проверьте что вы стали админом:**
   ```bash
   cat app/config.php
   ```

## Скрипт для автоматической проверки

На сервере выполните:
```bash
bash scripts/check_bot_status.sh
```

Этот скрипт проверит:
- Существование config.php
- Содержимое логов
- Статус webhook
- Запущенные процессы

## Включение режима отладки

Если проблема не решена, включите подробное логирование:

1. Отредактируйте `app/config.php`:
   ```php
   <?php
   
   $c = [
       'key' => 'ВАШ_ТОКЕН',
       'debug' => true,  // Добавьте эту строку
   ];
   ```

2. Перезапустите сервер

3. Проверьте `/logs/requests` - там будут все запросы и ответы

## Контакты для помощи

Если проблема не решена, пришлите:
1. Вывод команды `bash scripts/check_bot_status.sh`
2. Последние 50 строк из `/logs/php_error`
3. Последние 50 строк из `/logs/auth_debug`
4. Содержимое `app/config.php` (без токена!)

